const { commercesModel } = require('../models');
const { createMerchantCONTROLLER } = require('./auth');
const { matchedData } = require('express-validator');
const { handleError } = require('../utils/handleResponses');

const createCommerce = async (req, res) => {
    const data = matchedData(req);
    try {
        const merchant = await createMerchantCONTROLLER(data.email);

        if (!merchant) {
            console.log("No se pudo crear el comerciante")
            handleError(res, "No se pudo crear el comerciante", 400);
            return;
        }
        const newCommerce = new commercesModel({
            ...data,
            merchant: merchant._id
        });

        await newCommerce.save();
        console.log("Comercio creado")
        res.status(201).json({ message: 'Comercio y comerciante creados con Ã©xito', commerce: newCommerce });
    } catch (error) {
        console.log('Error interno al crear el comercio y comerciante')
        handleError(res, 'Error interno al crear el comercio y comerciante', 500);
    }
};

module.exports = { createCommerce };
